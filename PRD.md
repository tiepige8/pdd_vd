# 拼多多视频上传助手 PRD（基于当前已有功能）

> 版本：v1.0（现状梳理版）  
> 目标读者：产品 / 研发 / 测试 / 运营  
> 说明：本 PRD 仅覆盖目前已实现的功能，不新增需求。

---

## 1. 背景与目标
**背景**  
商家需要将百度网盘中的素材批量下载到本地并上传至拼多多视频，且希望减少人工操作、提升稳定性、留存可追溯日志。

**目标**  
- 提供“一键执行”完成“下载→上传”的自动化流程  
- 支持手动下载/上传与暂停/继续  
- 提供上传记录、日志、今日统计与进度  
- 支持 ASR 转写、标题生成与标签追加  
- 支持 BDUSS 登录与账号切换  
- 界面简单易用，信息清晰可追溯

---

## 2. 范围与不包含
**包含**
- 百度网盘下载（BaiduPCS-Go）
- 拼多多视频上传（接口调用）
- 自动化执行、进度、日志、状态
- ASR + 标题生成（DashScope）
- 上传记录与分页
- 日志（页面 & 本地每日日志）

**不包含**
- 账号体系/多用户管理
- 任务编排与多任务队列
- 上传素材编辑、视频剪辑
- 复杂监控/告警系统

---

## 3. 用户与场景
**目标用户**
- 运营/编辑人员：批量搬运与上传  
- 研发/运维：配置授权、排错、性能监控

**核心场景**
1. 早上点击“一键执行”，系统自动下载今日素材并自动上传  
2. 发现异常时暂停任务、排查后继续  
3. 查看当天操作日志与上传记录  
4. 需要换网盘账号时使用 BDUSS 登录/退出

---

## 4. 用户流程
1) 配置授权（拼多多 Token / 百度网盘 / 其他配置）  
2) 点击“一键执行”  
3) 系统下载今日目录 → 下载完成自动上传  
4) 实时查看进度、日志、上传记录  
5) 必要时暂停/继续、手动触发下载/上传

---

## 5. 功能需求（现状）

### 5.1 自动化执行
- **一键执行**：触发下载；下载完成后立即上传  
- **暂停任务 / 继续任务**：暂停下载与上传；继续后恢复  
- **运行状态**：显示“运行中 / 待执行”  
- **重启复位**：重启后自动清理“运行中”状态与进度  

### 5.2 手动操作
- **手动下载**：即时下载今日目录  
- **手动上传**：即时扫描并上传  
- **暂停/继续（下载/上传）**：单按钮切换状态  
- **状态刷新**：刷新上传状态 / 任务状态  
- **清空上传记录**：仅清除上传记录（不影响本地文件）  

### 5.3 进度展示（视频维度）
- 下载进度：`下载进度：当前/总数 + 文件名`  
- 上传进度：`上传进度：当前/总数 + 文件名`  

### 5.4 日志模块
- **单一日志视图**：不区分下载/上传  
- **今天 / 全部 切换**  
- **日志换行显示**  
- **清空日志**：仅清前端视图，不清本地日记文件  

### 5.5 上传记录
- 当天记录展示  
- **分页**：15 条/页  
- 字段：店铺 / 文件 / 状态 / 备注 / 开始 / 结束  

### 5.6 百度网盘登录
- **BDUSS 登录**（Electron 方式）  
- **退出登录**  
- **刷新状态**  
- **状态提示**：已登录/未登录/异常  

### 5.7 拼多多授权（Token）
- 生成授权链接  
- 展示 Access/Refresh Token/过期时间  
- 支持手动 code 换取  

### 5.8 ASR & 标题生成
- DashScope API Key  
- ASR 模型配置（默认 `qwen3-asr-flash`）  
- 标题模型配置（默认 `qwen-flash`）  
- 标题提示词（支持变量：`{transcript} {product_name} {min_len} {max_len}`）  
- 标签配置：每次随机选 2 个，追加到标题末尾，`#` 前加空格  

---

## 6. 数据与配置

### 6.1 配置文件
- `data/config.json`：授权、下载、ASR、标题等  
- `data/schedule.json`：上传节奏配置  
- `data/upload_state.json`：上传任务记录  
- `data/download_state.json`：下载记录  
- `data/auto_state.json`：自动化状态  
- `data/daily_logs/YYYYMMDD.txt`：每日操作日志

### 6.2 关键字段
- `downloadRemoteRoot`：网盘根目录  
- `downloadLocalRoot`：本地保存目录  
- `goodsId` / `productGoodsMap`  
- `asrEnabled` / `dashscopeAsrModel`  
- `titleEnabled` / `titlePrompt` / `titleTags` / `titleMinLen` / `titleMaxLen`

---

## 7. 去重策略（上传）
- **按“同店+同日”**  
- 已处理（`done/processing`）文件的相对路径 + 文件名都会被跳过  
- 若文件名相同且不同目录，也会跳过（避免重复上传）  

---

## 8. 关键接口
- `GET /api/config` / `POST /api/config`
- `GET /api/auth/url`
- `GET /api/tokens`
- `POST /api/oauth/exchange`
- `GET /api/upload/status`
- `POST /api/upload/scan`
- `POST /api/upload/pause` / `POST /api/upload/resume`
- `POST /api/download/manual`
- `POST /api/download/pause` / `POST /api/download/resume`
- `GET /api/logs` / `POST /api/logs/clear`
- `GET /api/auto/status` / `GET /api/auto/start`
- `GET /api/progress`
- `GET /api/baidu/status` / `POST /api/baidu/logout`
- `GET /api/system/ffmpeg`

---

## 9. 异常与提示
- 远端目录为空：日志明确提示  
- BaiduPCS-Go 不存在：日志提示路径配置  
- 授权缺失：上传暂停并提示  
- 上传卡住：日志提示“已有进行中任务”或“可能重复/已处理”  

---

## 10. 体验与交互
- 顶部强调“一键执行”  
- 手动区默认折叠  
- 操作反馈为短句、低噪音  
- 进度与状态具备清晰语义  

---

## 11. 非功能要求
- 可靠性：任务重启后状态复位，防止假“运行中”  
- 可追溯：日志持久化到本地  
- 性能：批量上传遵循间隔与上限  

---

## 12. 验收标准（现状）
- 一键执行能触发下载并完成后自动上传  
- 上传记录分页可用  
- 日志今天/全部切换正常  
- 下载/上传进度显示正确  
- 暂停/继续生效（单按钮切换）  
